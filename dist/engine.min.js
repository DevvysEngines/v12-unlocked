class e{constructor(){this.canvas=document.createElement("canvas"),this.canvas.style.position="fixed",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style.left=0,this.canvas.style.top=0,this.ctx=this.canvas.getContext("2d"),this.ctx.textAlign="center",document.body.insertBefore(this.canvas,document.body.childNodes[0])}}function t(e){return Math.PI/180*e}var s=Object.freeze({__proto__:null,distance:function(e,t,s,n){return Math.sqrt((s-e)*(s-e)+(n-t)*(n-t))},rotatepoint:function(e=0,s=0,n=0,i=0,r=0){n=t(n),s-=r;let o={x:(e-=i)*Math.cos(n)-s*Math.sin(n),y:e*Math.sin(n)+s*Math.cos(n)};return o.x+=i,o.y+=r,o},toradians:t,tosec:function(e){return e/1e3*60}}),n=Object.freeze({__proto__:null,aroundChunk:function(e=()=>{},t,s,n){const i=Y.currentscene.camera;t=t??i.chunk.x,s=s??i.chunk.y;for(let r=(n=n??i.show).width;r>=-n.width;r--)for(let i=n.height;i>=-n.height;i--)Y.currentscene.ifChunk(t-r,s-i)&&e({chunk:Y.currentscene.giveChunk(t-r,s-i),i:r,v:i,game:Y})},tomap:function(e,t){const s=Y.currentscene.camera,n=Y.window;return{x:(e-s.x)/s.zoom+n.width/2,y:(t-s.y)/s.zoom+n.height/2}},unmap:function(e,t){const s=Y.currentscene.camera,n=Y.window;return{x:e*s.zoom-n.width/2*s.zoom+s.x,y:t*s.zoom-n.height/2*s.zoom+s.y}}}),i=Object.freeze({__proto__:null,normalizePath:function(e){let t=[];return Array.isArray(e)||(e=[e]),e.forEach(e=>{"string"==typeof e?(e=e.split(/[.\[\]\/]+/).filter(e=>e.length),t.push(...e)):t.push(e)}),[...t]}});const r={...s,...Object.freeze({__proto__:null,giveColorWithTables:function(e,t){return`${e[0]},${e[1]},${e[2]},${t}`},givefont:function(e=16,t="sans-serif",s=""){return`${t} ${e}px ${s}`},measureText:function(e,t){return Y.ctx.font=utils.givefont(t.fontsize,t.fonttype,t.fontstyle),Y.ctx.measureText(e).width}}),...n,...i};class o{constructor(){window.addEventListener("resize",o.resize),window.addEventListener("keydown",o.keyboard),window.addEventListener("mousemove",o.mousemove),window.addEventListener("mousedown",o.mousedown),window.addEventListener("mouseup",o.mouseup),window.addEventListener("contextmenu",o.preventRight)}static preventRight(e){e.preventDefault()}static resize(){Y.canvas.width=Y.window.width=window.innerWidth,Y.window.height=Y.canvas.height=window.innerHeight,Y.ctx.textAlign="center"}static keyboard(e){switch(e.key){case"w":Y.currentscene.camera.y-=5;break;case"a":Y.currentscene.camera.x-=5;break;case"s":Y.currentscene.camera.y+=5;break;case"d":Y.currentscene.camera.x+=5;break;case"e":Y.currentscene.camera.zoom+=1/4;break;case"q":Y.currentscene.camera.zoom-=1/4}o.mousemove()}static mousemove(e=Y.mouse){Y.mouse.x=e.x,Y.mouse.y=e.y;let t=!1;for(let s in Object.values(Y.currentscene.uiList))s.ifover(e.x,e.y)?(s.set("mouse/over",!0),t=!0):1==s.get("mouse/over")&&s.set("mouse/over",!1);e=r.unmap(e.x,e.y),Y.mouse.filteredX=e.x,Y.mouse.filteredY=e.y,r.aroundChunk(s=>{Object.values(s.chunk.mouseElements).forEach(s=>{s.ifover(e.x,e.y)?(s.set("mouse/over",!0),t=!0):1==s.get("mouse/over")&&s.set("mouse/over",!1)})}),document.body.style.cursor=t?"pointer":"default",Y.mouse.isover=t}static mousedown(e){let t=0==e.button?"left":1==e.button?"middle":"right";"middle"==t&&e.preventDefault();for(let s in Object.values(Y.currentscene.uiList))s.ifover(e.x,e.y)&&(s.set(`mouse/${t}/down`,!0),s.set(`mouse/${t}/dragging`,!0));e=r.unmap(e.x,e.y),r.aroundChunk(s=>{Object.values(s.chunk.mouseElements).forEach(s=>{s.ifover(e.x,e.y)&&(s.set(`mouse/${t}/down`,!0),s.set(`mouse/${t}/dragging`,!0))})})}static mouseup(e){let t=0==e.button?"left":1==e.button?"middle":"right";"middle"==t&&e.preventDefault();for(let s in Object.values(Y.currentscene.uiList))s.ifover(e.x,e.y)&&(s.ifover(e.x,e.y)&&1==s.get(`mouse/${t}/down`)?(s.set(`mouse/${t}/down`,!1),s.set(`mouse/${t}/dragging`,!1)):1==s.get(`mouse/${t}/down`)&&(s.system_set(["mouse",t,"down"],!1),s.set(`mouse/${t}/dragging`,!1)));e=r.unmap(e.x,e.y),r.aroundChunk(s=>{Object.values(s.chunk.mouseElements).forEach(s=>{s.ifover(e.x,e.y)&&1==s.get(`mouse/${t}/down`)?(s.set(`mouse/${t}/down`,!1),s.set(`mouse/${t}/dragging`,!1)):1==s.get(`mouse/${t}/down`)&&(s.system_set(["mouse",t,"down"],!1),s.set(`mouse/${t}/dragging`,!1))})})}}class h{constructor(e,t,s){this.pos={x:t,y:s},this.scene=e,this.x=this.pos.x*this.scene.chunkSize,this.y=this.pos.y*this.scene.chunkSize,this.mouseElements={},this.allElements={},this.elements={},this.renderChunk()}addElement(e){e.get("properties/usesMouse")&&(this.mouseElements[e.id]=e),e.set("properties/chunk",this.pos);const t=e.color,s=e.id;let n;this.allElements[s]=e,this.elements[t]||(this.elements[t]={}),n=this.elements[t],n[s]=e}removeElement(e){this.mouseElements[e.id]&&delete this.mouseElements[e.id],e.set("properties/chunk",{x:-1,y:-1});const t=e.color,s=e.id;let n;delete this.allElements[s],this.elements[t]&&(n=this.elements[t],delete n[s],Object.keys(n).length<=0&&delete this.elements[t])}update(e,t){Object.values(this.allElements).forEach(s=>{s.update(e,t)})}render(e){Object.keys(this.elements).forEach(t=>{e.fillStyle=`rgba(${t})`,e.beginPath(),Object.values(this.elements[t]).forEach(t=>{t.render(e),e.closePath()}),e.fill()})}renderChunk(e){}}class a{x=0;y=0;zoom=1;rotation=0;chunk={x:0,y:0};show={width:5,height:5};constructor(e){e.addCamera(this)}update(){const e=this.scene.game.currentscene.locateChunkByPos(this.x,this.y),t={x:e.pos.x,y:e.pos.y},s=this.chunk;t.x==s.x&&t.y==s.y||(this.chunk=t)}}class c{constructor(e){this.Name=e,this.game=Y,this.chunks={},this.uiList={},this.chunkSize=600,this.addCamera(new a(this))}ifChunk(e=0,t=0){if(window.chunk=this,this.chunks[`${e}`]&&this.chunks[`${e}`][`${t}`])return!0}moveElementToChunk(e,t){e.chunk.removeElement(e),t.addElement(e)}giveChunk(e,t){return this.ifChunk(e,t)||this.insertChunk(e,t),this.chunks[`${e}`][`${t}`]}insertChunk(e,t){this.ifChunk(e,t),this.chunks[`${e}`]={},this.chunks[`${e}`][`${t}`]=new h(this,e,t)}locateChunkByPos(e,t){const s=Math.floor(e/this.chunkSize),n=Math.floor(t/this.chunkSize);return this.giveChunk(s,n)}addElement(e){if(e.get("properties/ui"))return void e.setToUi();const t=this.locateChunkByPos(e.x,e.y);t&&t.addElement(e)}removeElement(e){e.chunk.removeElement(e)}addCamera(e){this.camera=e,e.scene=this}render(e){r.aroundChunk(t=>{t.chunk.render(e)})}update(e){const t=60*e/1e3;r.aroundChunk(s=>{s.chunk.update(e,t)})}}function u(e=0){Y.time||(Y.time=e);const t=e-Y.time;Y.time=e,Y.ctx.clearRect(0,0,Y.window.width,Y.window.height),Y.currentscene.update(t);for(let e in Object.values(Y.currentscene.uiList))e.update(t,60*t/1e3);Y.currentscene.render(Y.ctx);for(let e in Object.values(Y.currentscene.uiList))Y.ctx.beginPath(),Y.ctx.fillStyle=`rgb(${e.color})`,e.render(Y.ctx),Y.ctx.fill();requestAnimationFrame(u)}class d{static box={render:(e,t)=>{e.roundRect(-t.width/2,-t.height/2,t.width,t.height,0),e.closePath()},ifover(e,t,s){let{x:n,y:i}=r.rotatepoint(e,t,s.rotation,s.x,s.y);return n>s.x-s.width/2&&n<s.x+s.width/2&&i<s.y+s.height/2&&i>s.y-s.height/2}};static arc={render:(e,t)=>{e.arc(0,0,t.radius,0,2*Math.PI),e.closePath()},ifover:(e,t,s)=>r.distance(e,t,s.x,s.y)<s.radius};static txt={render:(e,t,s)=>{e.font=r.givefont(t.fontsize,s.fonttype,s.fontstyle),e.fillText(s.string,0,t.fontsize/4)},ifover:(e,t,s,n,i)=>d.box.ifover(e,t,s)}}class l{#e={fired:function(){},signal:"script"};constructor(e){Object.assign(this,this.#e,e,{type:"script"})}}let m={};class f{static generateId=function(e=28){let t="";for(let s=0;s<e-4;s++)t+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-=+_|!@#$%^&*()".charAt(Math.floor(77*Math.random()));m[t]&&(t=f.generateId(e));let s=Math.floor(Math.random()*(t.length+1));return t=t.slice(0,s)+"gen-"+t.slice(s),m[t]=!0,t};static normalize_path(...e){let t=[];return e.forEach(e=>{"string"==typeof e?t.push(...e.replaceAll(".","/").replaceAll("[","/").replaceAll("]","").split("/")):t.push(e)}),t}static system_signal_converter(e="/",t="set"){return`*v9$:$${t[0]}?{>${f.normalize_path(e).join(">")}}*`}static ctxUse(e,t,s){return(...n)=>{t.set_context(e);let i=e.proto[s].call(t,...n);t.remove_context(),void 0!==i&&(Array.isArray(i)?e.info=i:"object"==typeof i&&Object.assign(e,i))}}}const g=f.system_signal_converter,p={path:"properties/x",fired(){},on_insert(){},on_removal(){},detect:"set"};var y=Object.freeze({__proto__:null,event:class extends l{constructor(e="properties/x",t=function(){},s=function(){},n=function(){},i="set"){let r,o,h={};"object"==typeof e?({path:r,detect:o,...h}={...p,...e}):(r=e,o=i,h={fired:t,on_insert:s,on_removal:n,event_node:!0}),super({...h,signal:g(r,o)})}}});const x={fired_function(){},on_insert_function(){},on_removal_function(){},detect:"update"},v={...y,...Object.freeze({__proto__:null,frame:class extends l{constructor(e=function(){},t=function(){},s=function(){},n="update"){let i,r;"object"==typeof e?({detect:i,...r}={...x,...e}):(i=n,r={fired:e,on_insert:t,on_removal:s,detect:n}),super({...r,signal:`-u$${i[0]}`})}}})};var _=Object.freeze({__proto__:null,scripts:v});class w{#t=[];#s={scripts_storage:{},signals_storage:{}};get id(){return this.#s.id}get context(){return this.#t[this.#t.length-1]}set_context(e){return this.#t.push(e)}remove_context(){return this.#t.pop()}system_set(e=[],t=0){let s,n=this.#s;for(let t=0;t<e.length-1;t++)"object"!=typeof n[e[t]]&&(n[e[t]]={}),n=n[e[t]];return s=n[e[e.length-1]],n[e[e.length-1]]=t,[s,t,...e]}system_delete(e=[]){let t,s=this.#s;for(let t=0;t<e.length-1;t++){if("object"!=typeof s[e[t]])return[void 0,!1,...e];s=s[e[t]]}return t=s[e[e.length-1]],delete s[e[e.length-1]],[t,!0,...e]}system_get(e=[]){let t=this.#s;for(let s=0;s<e.length-1;s++){if("object"!=typeof t[e[s]])return;t=t[e[s]]}return t[e[e.length-1]]}set(...e){let t=e.pop(),s=f.normalize_path(...e),n=this.system_set(s,t);if(n[0]==t)return;let i="";this.emit("*v9$:$s?{>>}*",n),s.forEach(e=>{i+=`>${e}`,this.emit(`*v9$:$s?{${i}>}*`,n)}),this.emit(`*v9$:$s?{${i}}*`,n)}get(...e){return this.system_get(f.normalize_path(...e))}delete(...e){let t=f.normalize_path(...e),s=this.system_delete(t);if(!s[1])return;let n="";this.emit("*v9$:$d?{>>}*",s),t.forEach(e=>{n+=`>${e}`,this.emit(`*v9$:$d?{${n}>}*`,s)}),this.emit(`*v9$:$d?{${n}}`,s)}constructor(e,...t){Object.assign(this.#s,e,{scripts_storage:{},signals_storage:{},id:f.generateId()}),t.forEach(e=>{this.insert(...e)})}}let b=class extends(function(e){return class extends e{insert(e,...t){let s={id:f.generateId(),info:t,proto:e};return s.run=f.ctxUse(s,this,"fired"),this.set(`scripts_storage/${s.id}`,s),this.set(`signals_storage/${s.proto.signal}/${s.id}`,!0),s.id}remove(e=this.context){"string"==typeof e&&(e=this.script(e)),this.delete(`scripts_storage/${e.proto.signal}/${e.id}`),this.delete(`scripts_storage/${e.id}`)}script(e=this.context.id){return this.system_get(["scripts_storage",e])}emit(e,...t){let s=this.system_get(["signals_storage",e]);s&&Object.keys(s).forEach(e=>{let s=this.script(e);s&&s.run(...t,...s.info)})}}}(w)){};class ${static module=b;static utilities=f;static script=l}const k={base_element:[[new v.event({path:"scripts_storage/",fired([,e]){e.proto.on_insert&&$.utilities.ctxUse(e,this,"on_insert")(...e.info)}})],[new v.event({path:"scripts_storage/",detect:"delete",fired([e]){e.proto.on_removal&&$.utilities.ctxUse(e,this,"on_removal")(...e.info)}})]]};var z=Object.freeze({__proto__:null,system_presets:k});class E{#e={triggerTimes:0,active:!0,condition:function(){return!0},trigger:function(){return!0},Name:"eventNode",tags:[],path:["properties/health"],onApply:function(){},onFinished:function(){}};constructor(e,t,s,n,i,o,h,a){"object"!=typeof e&&(e={Name:e,tags:t,path:s,condition:n,trigger:i,triggerTimes:o,onApply:h,onFinished:a}),Object.assign(this,{...this.#e},Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t))),this.tags=r.normalizePath(this.tags),this.path=r.normalizePath(this.path),this.type="eventNode"}}class j{#e={Name:"node",tags:[],onApply:function(){},update:function(){},onFinished:function(){},type:"node"};constructor(e,t,s,n,i){"object"!=typeof e&&(e={Name:e,tags:t,update:s,onApply:n,onFinished:i,type:"node"}),Object.assign(this,{...this.#e},Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t))),this.tags=r.normalizePath(this.tags),this.type="node"}}let O=E,C=["mouse"];function M(e){if(this.set("properties/usesMouse",!0),!e)return{info:[function(){}]}}function A(){this.searchForEventNodeByTag(C).length<=0&&this.set("properties/usesMouse",!1)}function L(e){return{Down:new O("mouseDown",[`mouse/presets/down/${e}`],[`mouse/${e}/down`],N,...T),Up:new O("mouseUp",[`mouse/presets/up/${e}`],[`mouse/${e}/down`],P,...T),Dragging:new O({path:[`mouse/${e}/dragging`],condition:N,trigger(){this.do()},onApply:M,onFinished:A})}}function N(e,t){return t}function P(e){return e}new j({update(e,t,...s){t.call(this,...s)}});let T=[function(e,t,...s){let n=t.call(this,...s);return n&&n.info&&n.info.unshift(t),n},0,M,A],S={Enters:new O("mouseEntered",["mouse/presets/entered"],["mouse/over"],N,...T),Leaves:new O("mouseLeft",["mouse/presets/left"],["mouse/over"],P,...T),Left:L("left"),Right:L("right"),Middle:L("middle")};var F=Object.freeze({__proto__:null,mouse:S}),I=Object.freeze({__proto__:null,effect:class{node;constructor(e,t,s,n,i){this.node=new j(e,t,s,n,i),this.Name=this.node.Name,this.tags=this.node.tags,this.type=this.node.type}onApply(e=1,...t){e*=60;let s=this.currentNode.node.node.onApply.call(this,...t);return s?(s.info||(s.info=[]),s.info=[e,...s.info],s):{info:[e,...t]}}update(e,t,...s){if(t<=0)return void this.remove();t-=e;let n=this.currentNode.node.node.update.call(this,e,...s);return n?(n.info||(n.info=[]),n.info=[t,...n.info],n):{info:[t,...s]}}onFinished(e,...t){let s=this.currentNode.node.node.onFinished.call(this,...t);if(s)return s.info||(s.info=[]),s.info=[e,...s.info],s}}});let U=E,D={arc:[new U({path:["renderer/radius"],tags:["arc"],trigger:function([e,t]){this.system_set("hitbox/radius",t)},onApply:function(){this.set("hitbox/radius",this.system_get(["renderer","radius"]))}})],box:[new U({path:["renderer/width"],tags:["box"],trigger:function([e,t]){this.set("hitbox/width",t)},onApply:function(){this.set("hitbox/width",this.system_get(["renderer","width"]))}}),new U({path:["renderer/height"],tags:["box"],trigger:function([e,t]){this.set("hitbox/height",t)},onApply:function(){this.set("hitbox/height",this.system_get(["renderer","height"]))}})],txt:[new U({path:["renderer/string"],tags:["txt"],trigger:function([e,t]){let s=this.system_get(["renderer"]),n=r.measureText(t,s);this.set("hitbox/width",n),this.set("hitbox/height",s.fontsize)},onApply:function(){let e=this.system_get(["renderer"]),t=r.measureText(e.string,e);this.set("hitbox/width",t),this.set("hitbox/height",e.fontsize)}})]},R=[new U({path:["renderer/rotation"],trigger:function([e,t]){this.set("hitbox/rotation",t)},onApply:function(){this.set("hitbox/rotation",this.system_get(["renderer","rotation"]))}}),new U({path:["renderer/x"],trigger:function([e,t]){this.set("hitbox/x",t)},onApply:function(){this.set("hitbox/x",this.system_get(["renderer","x"]))}}),new U({path:["renderer/y"],trigger:function([e,t]){this.set("hitbox/y",t)},onApply:function(){this.set("hitbox/y",this.system_get(["renderer","y"]))}})],B=[new U({path:["renderer/type"],tags:["linkHitboxToRenderer"],trigger:function([e,t]){this.set("hitbox/type",t),this.remove(...this.anyNodeByTag(e)),this.add(...D[t])},onApply:function(){let e=this.system_get(["renderer","type"]);this.set("hitbox/type",e),this.add(...R),this.add(...D[e])}})],H={...z,...F,...I,...Object.freeze({__proto__:null,linkHitboxToRenderer:B}),..._};const W={properties:{x:0,y:0,chunk:{x:0,y:0},ui:!1,inUi:!1},renderer:{type:"box",x:0,y:0,width:30,height:30,radius:15,string:"String",fonttype:"bold",fontstyle:"sans-serif",fontsize:20,roundedness:0,color:[0,0,0],rotation:0,transparency:1},hitbox:{type:"box",x:0,y:0,rotation:0,width:30,height:30,radius:15},reactions:{},reactionsList:{},nodes:{},mouse:{over:!1,left:{over:!1,dragging:!1},right:{over:!1,dragging:!1},middle:{over:!1,dragging:!1}}};class q extends b{update(...e){this.emit("-u$u",...e)}render(e){const t=this.dime;e.save(),e.translate(t.x,t.y);const s=this.system_get(["renderer"]);d[s.type].render(e,t,s),e.restore()}has(...e){return this.system_has(r.normalizePath(e))}system_has(e){return void 0!==this.system_get(e)}constructor(e={},t={},s={},...n){const i=structuredClone(W);if(i.properties={...i.properties,...e},i.renderer={...i.renderer,...t},i.hitbox={...i.hitbox,...s},super(i),n.length<1)return;let r=n.pop();"function"!=typeof r&&(n.push(r),r=!1),this.use(...H.system_presets.base_element),this.use(...n),r&&r.call(this)}}class X extends(function(e){return class extends e{use(...e){for(let t in e)Array.isArray(e[t])?this.insert(...e[t]):this.insert(e[t])}}}(function(e){return class extends e{get dime(){const e=this.system_get(["renderer"]),t=this.system_get(["properties"]);if(t.ui)return{x:Math.round(t.x+e.x),y:Math.round(t.y+e.y),width:Math.round(e.width),height:Math.round(e.height),radius:Math.round(e.radius),fontsize:e.fontsize,rotation:e.rotation};const s=Y.currentscene.camera,n=r.tomap(t.x+e.x,t.y+e.y);return{x:Math.round(n.x),y:Math.round(n.y),width:Math.round(e.width/s.zoom),height:Math.round(e.height/s.zoom),radius:Math.round(e.radius/s.zoom),fontsize:e.fontsize/s.zoom,rotation:e.rotation}}get hitboxDime(){let e=this.system_get(["hitbox"]);return{x:this.x+e.x,y:this.y+e.y,type:e.type,width:e.width,height:e.height,radius:e.radius,rotation:e.rotation}}}}(function(e){return class extends e{get color(){const e=this.system_get(["renderer"]);return Y.utils.giveColorWithTables(e.color,e.transparency)}get x(){return this.system_get(["properties","x"])}get y(){return this.system_get(["properties","y"])}get chunk(){let e=this.system_get(["properties"]).chunk;return Y.currentscene.giveChunk(e.x,e.y)}}}(q)))){constructor(e,t,s,...n){super(e,t,s,...n)}}let Y=new class{idList={};Canvas=new e;canvas=this.Canvas.canvas;ctx=this.Canvas.ctx;time=0;eventNode=E;node=j;presets=H;utils=r;script=l;v9=$;mouse={x:0,y:0,filteredX:0,filteredY:0,isover:!1};scenes={};allElements={};window={width:window.innerWidth,height:window.innerHeight};constructor(){let e=this;this.element=class extends X{constructor(t,s,n,...i){super(t,s,n,...i),e.addElement(this)}}}generateId=function(e=28){let t="";for(let s=0;s<e-4;s++)t+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-=+_|!@#$%^&*()<>".charAt(Math.floor(79*Math.random()));this.idList[t]&&(t=this.generateId(e));let s=Math.floor(Math.random()*(t.length+1));return t=t.slice(0,s)+"gen-"+t.slice(s),this.idList[t]=!0,t};begin(){this.events=new o(this),this.addScene("Main"),u()}addScene(e){this.currentscene=new c(e),this.scenes[e]=this.currentscene}callScene(e){this.scenes[e]&&(this.currentscene=this.scenes[e])}addElement(e){this.allElements[e.id]=e,this.currentscene.addElement(e)}removeElement(e){delete this.allElements[e.id],this.currentscene.removeElement(e)}};Y.begin();export{Y as game};
//# sourceMappingURL=engine.min.js.map
